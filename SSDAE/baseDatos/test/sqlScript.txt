-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."Alumnos"
(
    id_alumno serial NOT NULL,
    estatus character varying NOT NULL,
    fecha_ing date NOT NULL,
    CONSTRAINT id_alumno PRIMARY KEY (id_alumno)
);

CREATE TABLE IF NOT EXISTS public."Profesores"
(
    id_profesor serial NOT NULL,
    interno_externo integer NOT NULL,
    CONSTRAINT id_profesor PRIMARY KEY (id_profesor)
);

CREATE TABLE IF NOT EXISTS public."Usuarios"
(
    id_usuario serial NOT NULL,
    correo character varying NOT NULL,
    contrasena character varying NOT NULL,
    tipo_usuario character varying NOT NULL,
    nombre character varying NOT NULL,
    ap_p character varying NOT NULL,
    ap_m character varying NOT NULL,
    CONSTRAINT id_usuario PRIMARY KEY (id_usuario),
    CONSTRAINT correo_usuario_recuperacion UNIQUE (correo),
    CONSTRAINT id_usuario_usuario_tesis UNIQUE (id_usuario)
);

CREATE TABLE IF NOT EXISTS public."Recuperaciones"
(
    correo character varying NOT NULL,
    token character varying NOT NULL,
    fecha_expiracion date NOT NULL,
    id_recuperacion serial,
    CONSTRAINT id_recuperacion PRIMARY KEY (id_recuperacion)
);

CREATE TABLE IF NOT EXISTS public."Tesis"
(
    id_tesis serial NOT NULL,
    tema character varying NOT NULL,
    id_alumno serial,
    descripcion character varying NOT NULL,
    PRIMARY KEY (id_tesis)
);

ALTER TABLE IF EXISTS public."Alumnos"
    ADD CONSTRAINT id_alumnos FOREIGN KEY (id_alumno)
    REFERENCES public."Usuarios" (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."Profesores"
    ADD CONSTRAINT id_profesores FOREIGN KEY (id_profesor)
    REFERENCES public."Usuarios" (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."Recuperaciones"
    ADD CONSTRAINT correo_usuario FOREIGN KEY (correo)
    REFERENCES public."Usuarios" (correo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."Tesis"
    ADD CONSTRAINT id_alumno_usuario FOREIGN KEY (id_alumno)
    REFERENCES public."Usuarios" (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;
	
		 
INSERT INTO "Usuarios"
	VALUES (default,'root@gmail.com', 'c4ca4238a0b923820dcc509a6f75849b', 'root', 'jose', 'sanchez', 'soto'),
			(default,'diegomorales@gmail.com', 'c2ae0b5ba085cb33fbee01aafc391538', 'alumno', 'diego', 'morales', 'bravo'),
			(default,'ikertoscano@gmail.com', '272b5eb31e1c7ff85a96f076fbea4d17', 'alumno', 'iker', 'toscano', 'santos');
			
	

END;
